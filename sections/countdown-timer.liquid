{% schema %}
{
  "name": "Countdown Timer",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Annual Sale Event"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Get 20% OFF selected items. Limited time only."
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Shop The Sale"
    },
    {
      "type": "datetime",
      "id": "end_time",
      "label": "Countdown End Time (in store timezone)",
      "default": "2025-12-31T23:59"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#661b10"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 12,
      "max": 48,
      "step": 1,
      "unit": "px",
      "label": "Font Size",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Padding (top & bottom)",
      "default": 40
    }
  ],
  "presets": [
    {
      "name": "Countdown Timer",
      "category": "Promotional"
    }
  ]
}
{% endschema %}

<div class="countdown-timer" style="background: {{ settings.background_color }}; color: {{ settings.text_color }}; padding: {{ settings.padding }}px 0;">
  <div class="countdown-timer__content">
    <div class="countdown-timer__text">
      <h2 style="font-size: {{ settings.font_size }}px;">{{ settings.heading }}</h2>
      <p style="font-size: {{ settings.font_size | divided_by: 1.5 }}px;">{{ settings.subheading }}</p>
    </div>
    <div class="countdown-timer__countdown" data-end-time="{{ settings.end_time }}"></div>
    {% if settings.button_text != blank %}
      <div class="countdown-timer__button">
        <a href="{{ settings.button_link }}" class="btn" style="color: {{ settings.text_color }}; border: 1px solid {{ settings.text_color }}">{{ settings.button_text }}</a>
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    function startCountdown(endTimeStr) {
      const endTime = new Date(endTimeStr);
      const container = document.querySelector('[data-end-time]');
      if (!container) return;

      function updateCountdown() {
        const now = new Date();
        const diff = endTime - now;

        if (diff <= 0) {
          container.innerHTML = '<span>Expired</span>';
          return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((diff / (1000 * 60)) % 60);
        const seconds = Math.floor((diff / 1000) % 60);

        container.innerHTML = `
          <div class="countdown-block"><div class="number">${days}</div><div class="label">DAYS</div></div>
          <div class="colon">:</div>
          <div class="countdown-block"><div class="number">${hours}</div><div class="label">HOURS</div></div>
          <div class="colon">:</div>
          <div class="countdown-block"><div class="number">${minutes}</div><div class="label">MINS</div></div>
          <div class="colon">:</div>
          <div class="countdown-block"><div class="number">${seconds}</div><div class="label">SECS</div></div>
        `;
      }

      updateCountdown();
      setInterval(updateCountdown, 1000);
    }

    const countdownEl = document.querySelector('[data-end-time]');
    if (countdownEl) {
      startCountdown(countdownEl.dataset.endTime);
    }
  });
</script>

<style>
  .countdown-timer__content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 40px;
    flex-wrap: wrap;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .countdown-timer__text {
    flex: 1 1 30%;
  }

  .countdown-timer__countdown {
    display: flex;
    gap: 10px;
    font-weight: bold;
  }

  .countdown-block {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .countdown-block .number {
    font-size: 2em;
  }

  .countdown-block .label {
    font-size: 0.75em;
  }

  .countdown-timer__button {
    flex: 1 1 20%;
    display: flex;
    justify-content: center;
  }

  .countdown-timer__button a {
    padding: 10px 20px;
    border-radius: 4px;
    text-decoration: none;
  }

  @media (max-width: 768px) {
    .countdown-timer__content {
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 20px;
    }

    .countdown-timer__countdown {
      justify-content: center;
    }

    .countdown-timer__button {
      width: fit-content;
    }
  }
</style>
